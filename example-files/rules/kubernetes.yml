Version: 1
Description: Rules for Kubernetes spec files
Type: Kubernetes
Files:
  - "*.yml"
Rules:
  - id: ALLOW_KIND
    severity: FAILURE
    message: Allowed kinds
    resource: "*"
    assertions:
      - type: value
        key: kind
        op: in
        value: Pod,Policy,ServiceAccount
  - id: POD_CONTAINERS
    severity: FAILURE
    message: Pod must include containers
    resource: Pod
    assertions:
      - type: value
        key: spec.containers
        op: present
  - id: POD_SERVICE_ACCOUNT
    severity: FAILURE
    message: Pod should use a service account
    resource: Pod
    assertions:
      - type: value
        key: serviceAccountName
        op: present
  - id: POLICY
    severity: FAILURE
    message: Policy must include a spec
    resource: Policy
    assertions:
      - type: value
        key: spec
        op: present
  - id: DEFAULT_NAMESPACE
    severity: FAILURE
    message: Policy should not use default namespace
    resource: Policy
    assertions:
      - type: value
        key: spec.namespace
        op: ne
        value: default
  - id: CUSTOM
    severity: FAILURE
    message: Custom
    resource: Policy
    invoke:
      url: https://19kfojjbi2.execute-api.us-east-1.amazonaws.com/dev
      payload: "{ user: spec.user, namespace: spec.namespace }"
    tags:
      - custom
